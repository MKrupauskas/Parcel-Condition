<!DOCTYPE html>
<html lang="lt">
  <head>
    <title>Second Interface</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css?family=Overpass" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  </head>
  <body>
	<div id="title">
	    <h1><a href="../index.html">Your Package</a></h1>
	</div>
	<div id="legend"></div>

  <div id="map"></div>
  <script>
let map;
let data;
let legend = document.getElementById('legend');
const title = document.getElementById('switch');
let coordLat, coordLng, temperature, humidity, battery;
getData();
let infoWindowContent =
	"<div id='infoBox'><p>latitude: " +
	coordLat +
	'<br/>longitude: ' +
	coordLng +
	'</p></div>';
let legendInfoContent = [
	'<p id="info">Information</p>',
	'<p><b>Temperature: </b>' + temperature + 'Â°C</br><span>(Optimal)</span></p>',
	'<p><b>Humidity: </b>' + humidity + '%</br><span>(Optimal)</span></p>',
	'<p ><b>Battery: </b>' + battery + '%</br><span>(Optimal)</span></p>',
	'<p><b>Condition: </b><span>Good</span></p>'
];

function getData () {
$.ajax({
	url: '../data.json',
	async: false,
	success: function(tempData) {
		data = tempData;
    coordLat = data['live']['2'];
    coordLng = data['live']['3'];
    temperature = data.live['200'];
    humidity = Math.round(data.live['220']);
    battery = data.live['10'];
	},
	dataType: 'json'
});
}

function initMap() {
	map = new google.maps.Map(document.getElementById('map'), {
		zoom: 16,
		mapTypeId: google.maps.MapTypeId.ROADMAP,
		disableDefaultUI: true,
		zoomControl: true,
		center: { lat: coordLat, lng: coordLng},
		styles: [
			{ featureType: 'all', elementType: 'all', stylers: [{ hue: '#008eff' }] },
			{
				featureType: 'poi',
				elementType: 'all',
				stylers: [{ visibility: 'off' }]
			},
			{
				featureType: 'road',
				elementType: 'all',
				stylers: [{ saturation: '0' }, { lightness: '0' }]
			},
			{
				featureType: 'transit',
				elementType: 'all',
				stylers: [{ visibility: 'off' }]
			},
			{
				featureType: 'water',
				elementType: 'all',
				stylers: [
					{ visibility: 'simplified' },
					{ saturation: '-60' },
					{ lightness: '-20' }
				]
			}
		]
	});

	let marker = new google.maps.Marker({
		position: new google.maps.LatLng(data['live']['2'], data['live']['3']),
		icon: '../images/test.png',
		map: map
	});

	let infoWindow = new google.maps.InfoWindow();
	marker.addListener('click', function(event) {
		infoWindow.setContent(infoWindowContent);
		infoWindow.setPosition(event.latLng);
		infoWindow.open(map);
	});

  drawLegend();

	map.controls[google.maps.ControlPosition.TOP_CENTER].push(title);
	map.controls[google.maps.ControlPosition.LEFT_CENTER].push(legend);
}

function drawLegend() {
  legend.innerHTML = "";
  for (let i = 0; i < legendInfoContent.length; i++) {
    let holder = document.createElement('div');
    holder.innerHTML = legendInfoContent[i];
    legend.appendChild(holder);
  }
}

</script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC6ptOYFDBKkUQmlJgwSla1apd3tN4RknI&callback=initMap"
    async defer></script>
  </body>
</html>
