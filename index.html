<html>
<head>
  <meta charset="UTF-8">
  <script language="javascript" type="text/javascript" src="libraries/p5.js"></script>
  <!-- uncomment lines below to include extra p5 libraries -->
  <!--<script language="javascript" src="libraries/p5.dom.js"></script>-->
  <!--<script language="javascript" src="libraries/p5.sound.js"></script>-->
  <script language="javascript" type="text/javascript" src="sketch.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="oauth.js"></script>

  <!-- this line removes any default padding and style. you might only need one of these values set. -->
  <style> body {padding: 0; margin: 0;} </style>
</head>
<body>

  <div id="googleMap" style="width:100%;height:400px;"></div>

  <script>
  OAuth.initialize('Khtcm8GGKuezCJE1qU6ED7y9p');
  // var clientId = "MyApp";
  // var clientSecret = "MySecret";
  //
  // var authorizationBasic = (clientId + ':' + clientSecret);
  //
  // $.ajax({
  //     type: 'POST',
  //     url: oAuth.AuthorizationServer,
  //     data: { username: 'Parcel_Condition', password: 'iot101', grant_type: 'password' },
  //     dataType: "json",
  //     contentType: 'https://www.emcom.eu/api/v1/device/3975/; charset=utf-8',
  //     xhrFields: {
  //        withCredentials: true
  //     },
  //     // crossDomain: true,
  //     headers: {
  //        'Authorization': 'Basic ' + authorizationBasic
  //     },
  //     //beforeSend: function (xhr) {
  //     //},
  //     success: function (result) {
  //        var token = result;
  //     },
  //     //complete: function (jqXHR, textStatus) {
  //     //},
  //     error: function (req, status, error) {
  //     alert(error);
  //     }
  // });

  var clientId = "MyApp";
  var clientSecret = "MySecret";

  var authorizationBasic = (clientId + ':' + clientSecret);

  var request = new XMLHttpRequest();
  request.open('POST', OAuth.AuthorizationServer, true);
  request.setRequestHeader('Content-Type', 'https://www.emcom.eu/api/v1/device/3975/; charset=UTF-8');
  request.setRequestHeader('Authorization', 'Basic ' + authorizationBasic);
  request.setRequestHeader('Accept', 'application/json');
  request.send("username=Parcel_Condition&password=iot101&grant_type=password");

  request.onreadystatechange = function () {
      if (request.readyState === 4) {
         alert(request.responseText);
      }
  };


  let mapProp;
  let map;
  let marker;
  let coordLat = 54.6979;
  let coordLng = 25.3118;

  function myMap() {
  mapProp= {
      center:new google.maps.LatLng(coordLat, coordLng),
      zoom:18,
  };
  map=new google.maps.Map(document.getElementById("googleMap"),mapProp);

  marker = new google.maps.Marker({position: mapProp.center, icon: "test.png"});

  marker.setMap(map);

  }
  setInterval(tick, 250);


  function tick () {
    var latlng = new google.maps.LatLng(coordLat, coordLng);
    marker.setPosition(latlng);
    coordLat += 0.0001;
  }
  </script>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDJ5-FyeW41v4dRWq9AJP-lkQCYrIbGIkY&callback=myMap"></script>


</body>
</html>
